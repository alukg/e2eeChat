<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="/../style.css">

    <!---- Font ----->
    <link href="https://fonts.googleapis.com/css?family=Lobster" rel="stylesheet">

    <title>Encrypted End-To-End Chat</title>
</head>
<body>

<div class="container-fluid">
    <div class="container">
        <hr>
        <h2 class="text-center" id="title">Encrypted End-To-End Chat</h2>
        <hr>
        <div id="login-window" class="row">
            <div class="col-md-5">
                <form id="signup">
                    <fieldset>
                        <p class="text-uppercase pull-center"> SIGN UP:</p>
                        <div class="form-group">
                            <input type="email" name="upEmail" id="upEmail" class="form-control input-lg" placeholder="Email Address">
                        </div>
                        <div class="form-group">
                            <input type="password" name="upPassword" id="upPassword" class="form-control input-lg" placeholder="Password">
                        </div>
                        <div class="form-group">
                            <input type="password" name="confirmPassword" id="confirmPassword" class="form-control input-lg" placeholder="Validate password">
                        </div>
                        <div class="form-group registrationFormAlert" id="divCheckPasswordMatch">
                        </div>
                        <div>
                            <input type="submit" class="btn btn-md btn-primary" value="Sign Up">
                        </div>
                    </fieldset>
                </form>
            </div>

            <div class="col-md-2">
                <!-------null------>
            </div>

            <div class="col-md-5">
                <form id="signin">
                    <fieldset>
                        <p class="text-uppercase"> Login using your account: </p>
                        <div class="form-group">
                            <input type="email" name="inEmail" id="inEmail" class="form-control input-lg" placeholder="Email Address">
                        </div>
                        <div class="form-group">
                            <input type="password" name="inPassword" id="inPassword" class="form-control input-lg" placeholder="Password">
                        </div>
                        <div>
                            <input type="submit" class="btn btn-md" value="Sign In">
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>

        <div class="row chat-window">
            <div class="col-md-5">

            </div>

            <div class="col-md-5">

            </div>
        </div>
    </div>
    <p class="text-center">
        <small id="passwordHelpInline" class="text-muted"></small>
    </p>
</div>

<script src="/socket.io/socket.io.js"></script>
<script src="/jquery/dist/jquery.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="/bootstrap/dist/js/bootstrap.js"></script>
<script>
    function connect(username,pass,sts) {
        var socket = io.connect('http://localhost:4200', {query: 'sts=' + sts + '&' + 'name=' + username + '&' + 'pass=' + pass});
        // Add a connect listener
        socket.on('connect', function () {
            alert('Client has connected to the server!');
            //$("#login-window").hide();
        });
        // Add a connect listener
        socket.on('serverMessage', function (data) {
            alert('Received a message from the server:\n' + data);
        });
        // Add a disconnect listener
        socket.on('disconnect', function () {
            alert('The client has disconnected!');
        });
    }

    // Sends a message to the server via sockets
    function sendMessageToServer(message) {
        socket.emit('clientMessage', message);
    }
</script>

<!-- signup and signin script -->

<script>
    var FuncSts = {"signin":1, "signup":2}
    Object.freeze(FuncSts);

    $(document).ready(function () {
        $("#upPassword, #confirmPassword").keyup(checkPasswordMatch);
    });

    function checkPasswordMatch() {
        var password = $("#upPassword").val();
        var confirmPassword = $("#confirmPassword").val();

        if(password == "" && confirmPassword == "")
        {
            $("#divCheckPasswordMatch").html("");
            return false;
        }
        else
        {
            if (password != confirmPassword) {
                $("#divCheckPasswordMatch").html("Passwords do not match!");
                return false;
            }
            else {
                $("#divCheckPasswordMatch").html("Passwords match.");
                return true;
            }
        }
    }

    function processSignInForm(e) {
        if (e.preventDefault) e.preventDefault();

        var username = $("#inEmail").val();
        var password = $("#inPassword").val();

        connect(username,password,FuncSts.signin);

        return false;
    }

    var signInForm = document.getElementById('signin');
    if (signInForm.attachEvent) {
        signInForm.attachEvent("submit", processSignInForm);
    } else {
        signInForm.addEventListener("submit", processSignInForm);
    }

    function processSignUpForm(e) {
        if (e.preventDefault) e.preventDefault();

        if (checkPasswordMatch() === false)
            return false;

        var username = $("#upEmail").val();
        var password = $("#upPassword").val();

        connect(username,password,FuncSts.signup);

        return false;
    }

    var signUpForm = document.getElementById('signup');
    if (signUpForm.attachEvent) {
        signUpForm.attachEvent("submit", processSignUpForm);
    } else {
        signUpForm.addEventListener("submit", processSignUpForm);
    }
</script>

</body>
</html>